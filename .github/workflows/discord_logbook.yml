name: Discord Logbook

on:
  push:
  pull_request:
    # We now listen for 'closed' events too
    types: [opened, closed]

jobs:
  discord-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # 1. PUSH Notification
      - name: Discord Notification (Push)
        if: github.event_name == 'push'
        uses: ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            **${{ github.actor }}** pushed to branch `${{ github.ref_name }}`
            ```
            ${{ github.event.head_commit.message }}
            ```

      # 2. PR OPENED Notification
      # Added check for 'action == opened' so this doesn't fire on merge
      - name: Discord Notification (PR Opened)
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        uses: ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            **${{ github.actor }}** opened a new Pull Request!
            **Title:** ${{ github.event.pull_request.title }}
            **Link:** <${{ github.event.pull_request.html_url }}>

      # 3. PR MERGED (ACCEPTED) Notification
      # Checks if event is 'closed' AND 'merged' is true
      - name: Discord Notification (PR Merged)
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            âœ… **Pull Request Accepted!**
            **Merged by:** ${{ github.actor }}
            **Title:** ${{ github.event.pull_request.title }}
            **Link:** <${{ github.event.pull_request.html_url }}>